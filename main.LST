C51 COMPILER V9.52.0.0   MAIN                                                              11/28/2017 19:37:21 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include<reg52.h>
   2          #define u16 unsigned int 
   3          #define v0 50 //0
   4          #define v1 40 //L R
   5          #define v2 60 //LL RR
   6          #define D 100 //delay
   7          #define v3 70 //
   8          int runPwm(u16 arg);
   9          void delay(u16 i);
  10          int get_status();
  11          
  12          sbit Linput = P2^0;
  13          sbit Rinput = P2^1;
  14          sbit LLinput = P2^2;
  15          sbit RRinput = P2^3;
  16          sbit Loutput = P1^0;
  17          sbit Routput = P3^3;
  18          u16 Lduty_ratio=0;    //Left duty ratio
  19          u16 Rduty_ratio=0;    //Right duty ratio
  20          u16 cycle_limit=100;  //Pwm cycle limit
  21          u16 cycle=0;          //Pwm cycle value
  22          u16 flag=0;           //status flag || 0 for none || 1 for Left input || 2 for right input || 3 for both
  23          u16 Ojudge=0;
  24          sbit LL=P3^4;
  25          sbit LR=P3^5;
  26          sbit RL=P3^6;
  27          sbit RR=P3^7;
  28          
  29          
  30          
  31          void main(){
  32   1        TMOD=0x01;
  33   1        TH0=(65536-20)/256;
  34   1        TL0=(65536-20)%256;
  35   1        EA=1;
  36   1        ET0=1;
  37   1        TR0=1;
  38   1        while(1){
  39   2          flag=get_status();
  40   2          if(flag==0){
  41   3            LL=0;
  42   3            LR=1;
  43   3            RL=0;
  44   3            RR=1;
  45   3            Lduty_ratio = v0;
  46   3            Rduty_ratio = v0;
  47   3          }else if(flag==1){
  48   3            RL=0;
  49   3            RR=1;
  50   3            LL=1;
  51   3            LR=0;
  52   3            Lduty_ratio = v1;  //turn left
  53   3            Rduty_ratio = v2;
  54   3          }else if(flag==2){
  55   3            LL=0;
C51 COMPILER V9.52.0.0   MAIN                                                              11/28/2017 19:37:21 PAGE 2   

  56   3            LR=1;
  57   3            RL=1;
  58   3            RR=0;
  59   3            Lduty_ratio = v2;  //turn right
  60   3            Rduty_ratio = v1;
  61   3          }else if(flag==3){
  62   3            RL=0;
  63   3            RR=1;
  64   3            LL=1;
  65   3            LR=0;
  66   3            Lduty_ratio = v3;  //turn left rapidly
  67   3            Rduty_ratio = v3;
  68   3      //      delay(D);
  69   3          }else if(flag==4){
  70   3            LL=0;
  71   3            LR=1;
  72   3            RL=1;
  73   3            RR=0;
  74   3            Lduty_ratio = v3;  //turn right rapidly
  75   3            Rduty_ratio = v3;
  76   3      //      delay(D);
  77   3          }
  78   2        }
  79   1      }
  80          
  81          
  82          
  83          void T0_interrupt() interrupt 1{
  84   1        TH0=(65536-20)/256;
  85   1        TL0=(65536-20)%256;
  86   1        Loutput = runPwm(Lduty_ratio);
  87   1        Routput = runPwm(Rduty_ratio);
  88   1        flag=get_status();
  89   1        cycle++;
  90   1        if(cycle==100){
  91   2          cycle=0;
  92   2        }
  93   1      }
  94          
  95          int runPwm(u16 arg){
  96   1        if(cycle<arg){
  97   2          return 1;
  98   2        }else{
  99   2          return 0;
 100   2        }
 101   1      }
 102          
 103          int get_status(){
 104   1      //  if(Linput==1){
 105   1      //      return 1;
 106   1      //  }else if(Rinput==1){
 107   1      //    return 2;
 108   1      //  }else{  
 109   1      //    return 0;
 110   1      //  }
 111   1        if(Linput==1){
 112   2            return 1;
 113   2        }
 114   1        if(Rinput==1){
 115   2            return 2;
 116   2        }
 117   1        if(LLinput==1){
C51 COMPILER V9.52.0.0   MAIN                                                              11/28/2017 19:37:21 PAGE 3   

 118   2            return 3;
 119   2        } 
 120   1        if(RRinput==1){
 121   2            return 4;
 122   2        }
 123   1        return 0;
 124   1      }
 125          
 126          void delay(u16 i){
 127   1        while(i--);
 128   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    339    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
